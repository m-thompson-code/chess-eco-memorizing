<div mooSquare class="board">
    <ng-container *ngIf="board">
        <div [class]="'background-layer' + (board.boardOrientation === 'flipped' ? ' flipped' : '')">
            <div *ngFor="let row of board.spaces; let y = index" [class]="'row' + (board.boardOrientation === 'flipped' ? ' flipped' : '')">
                <moo-space *ngFor="let space of row; let x = index"
                [activeSpace]="activeSpace" 
                [movedToSpace]="movedToSpace" 
                [movedFromSpace]="movedFromSpace" 
                [hoverStartFromSpace]="hoverStartFromSpace" 
                [hoverSpace]="hoverSpace" 
                [space]="space"></moo-space>
            </div>
        </div>
    
        <div class="pieces-layer">
            <div [class]="'piece-container' + (board.boardOrientation === 'flipped' ? ' flipped' : '')">
                <ng-container *ngFor="let piece of board.pieces">
                    <moo-piece *ngIf="piece.active" [piece]="piece"></moo-piece>
                </ng-container>
            </div>
        </div>
        
        <div [class]="'draggable-layer' + (board.boardOrientation === 'flipped' ? ' flipped' : '')">
            <div *ngFor="let row of board.spaces; let y = index" [class]="'row' + (board.boardOrientation === 'flipped' ? ' flipped' : '')">
                <moo-draggable-space *ngFor="let space of row; let x = index"
                (dragStarted)="handleDragStarted($event)"
                (dragEnded)="handleDragEnded($event)"
                (dragMoved)="handleDragMoved($event)"
        
                [touchDragging]="touchDragging"
                [hoverSpace]="hoverSpace"
                [space]="space" (click)="activateSpace(space)"></moo-draggable-space>
            </div>
        </div>
    </ng-container>
</div>
